<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ü•á Í∏à ÏãúÏû• Ïã§ÏãúÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                color: #ecf0f1;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .header {
                text-align: center;
                padding: 30px 20px;
                background: rgba(0, 0, 0, 0.2);
                backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .header h1 {
                font-size: 2.5em;
                color: #f39c12;
                margin-bottom: 10px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .status-bar {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 20px;
                margin-top: 15px;
                flex-wrap: wrap;
            }

            .status-item {
                background: rgba(255, 255, 255, 0.1);
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 0.9em;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .status-running {
                background: rgba(46, 204, 113, 0.2);
                border-color: #2ecc71;
                color: #2ecc71;
            }

            .status-stopped {
                background: rgba(231, 76, 60, 0.2);
                border-color: #e74c3c;
                color: #e74c3c;
            }

            .main-content {
                flex: 1;
                padding: 40px 20px;
                max-width: 1000px;
                margin: 0 auto;
                width: 100%;
            }

            .data-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 25px;
                margin-bottom: 30px;
            }

            .data-card {
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 15px;
                padding: 25px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            }

            .data-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .card-header {
                display: flex;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .card-icon {
                font-size: 1.8em;
                margin-right: 10px;
            }

            .card-title {
                font-size: 1.2em;
                font-weight: 600;
                color: #ecf0f1;
            }

            .price-display {
                font-size: 2.2em;
                font-weight: 700;
                color: #f39c12;
                margin: 15px 0;
                text-align: center;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .price-change {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                margin-bottom: 15px;
            }

            .change-positive {
                color: #2ecc71;
            }

            .change-negative {
                color: #e74c3c;
            }

            .data-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .data-row:last-child {
                border-bottom: none;
            }

            .data-label {
                color: #bdc3c7;
                font-size: 0.9em;
            }

            .data-value {
                color: #ecf0f1;
                font-weight: 500;
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: #7f8c8d;
                font-size: 1.1em;
            }

            .error {
                background: rgba(231, 76, 60, 0.1);
                border: 1px solid rgba(231, 76, 60, 0.3);
                color: #e74c3c;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                margin-bottom: 20px;
            }

            .update-time {
                text-align: center;
                margin-top: 30px;
                color: #7f8c8d;
                font-size: 0.9em;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.6;
                }
            }

            .updating {
                animation: pulse 1s infinite;
            }

            /* ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
            .table-container {
                overflow-x: auto;
                margin-top: 20px;
            }

            .data-table {
                width: 100%;
                border-collapse: collapse;
                background: rgba(255, 255, 255, 0.02);
                border-radius: 8px;
                overflow: hidden;
            }

            .data-table th {
                background: rgba(255, 255, 255, 0.1);
                color: #f39c12;
                padding: 12px 8px;
                text-align: center;
                font-weight: 600;
                font-size: 0.85em;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                white-space: nowrap;
            }

            .data-table td {
                padding: 10px 8px;
                text-align: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                color: #ecf0f1;
                font-size: 0.9em;
                white-space: nowrap;
            }

            .data-table tr:hover {
                background: rgba(255, 255, 255, 0.05);
            }

            .data-table tr:nth-child(even) {
                background: rgba(255, 255, 255, 0.02);
            }

            .loading-row {
                text-align: center;
                color: #7f8c8d;
                font-style: italic;
            }

            .time-column {
                color: #3498db;
                font-weight: 500;
                min-width: 80px;
            }

            .price-cell {
                color: #f39c12;
                font-weight: 500;
            }

            .volume-cell {
                color: #95a5a6;
            }

            .usd-cell {
                color: #e74c3c;
                font-weight: 500;
            }

            @media (max-width: 768px) {
                .header h1 {
                    font-size: 2em;
                }

                .status-bar {
                    flex-direction: column;
                    gap: 10px;
                }

                .data-grid {
                    grid-template-columns: 1fr;
                    gap: 20px;
                }

                .price-display {
                    font-size: 1.8em;
                }

                .data-table {
                    font-size: 0.8em;
                }

                .data-table th,
                .data-table td {
                    padding: 8px 4px;
                }

                .data-table th {
                    font-size: 0.75em;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>ü•á Í∏à ÏãúÏû• Ïã§ÏãúÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú</h1>
            <div class="status-bar">
                <div id="collectionStatus" class="status-item">üîÑ ÏàòÏßë ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...</div>
                <div id="updateTime" class="status-item">üìÖ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÍ∞Ñ ÌôïÏù∏ Ï§ë...</div>
                <div id="autoRefresh" class="status-item">‚ö° 1Ï¥à ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®</div>
            </div>
        </div>

        <div class="main-content">
            <div id="errorContainer"></div>

            <div id="loadingMessage" class="loading">üîÑ Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>

            <div id="dataContainer" style="display: none">
                <div class="data-grid">
                    <!-- USD/KRW ÌôòÏú® -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">üí±</span>
                            <span class="card-title">USD/KRW ÌôòÏú®</span>
                        </div>
                        <div id="usdPrice" class="price-display">-</div>
                        <div id="usdChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">Ï∂úÏ≤ò</span>
                            <span class="data-value">Yahoo Finance</span>
                        </div>
                    </div>

                    <!-- Íµ≠ÎÇ¥ Í∏à ETF -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">üèõÔ∏è</span>
                            <span class="card-title">Íµ≠ÎÇ¥ Í∏à ETF (411060)</span>
                        </div>
                        <div id="domesticPrice" class="price-display">-</div>
                        <div id="domesticChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">Îß§ÏàòÌò∏Í∞Ä</span>
                            <span id="domesticBid" class="data-value">-</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Îß§ÎèÑÌò∏Í∞Ä</span>
                            <span id="domesticAsk" class="data-value">-</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Í±∞ÎûòÎüâ</span>
                            <span id="domesticVolume" class="data-value">-</span>
                        </div>
                    </div>

                    <!-- ÎØ∏Íµ≠ Í∏àÏÑ†Î¨º -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">üá∫üá∏</span>
                            <span class="card-title">ÎØ∏Íµ≠ Í∏àÏÑ†Î¨º</span>
                        </div>
                        <div id="usPrice" class="price-display">-</div>
                        <div id="usChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">ÏÉÅÌÉú</span>
                            <span id="usStatus" class="data-value">ÌôïÏù∏ Ï§ë</span>
                        </div>
                    </div>

                    <!-- Íµ≠ÎÇ¥ Í∏àÌòÑÎ¨º -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">‚ú®</span>
                            <span class="card-title">Íµ≠ÎÇ¥ Í∏àÌòÑÎ¨º</span>
                        </div>
                        <div id="goldSpotPrice" class="price-display">-</div>
                        <div id="goldSpotChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">Îß§ÏàòÌò∏Í∞Ä</span>
                            <span id="goldSpotBid" class="data-value">-</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Îß§ÎèÑÌò∏Í∞Ä</span>
                            <span id="goldSpotAsk" class="data-value">-</span>
                        </div>
                    </div>

                    <!-- NAV Í≥ÑÏÇ∞ -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">üí∞</span>
                            <span class="card-title">NAV (Ïù¥Î°†Í∞ÄÍ≤©)</span>
                        </div>
                        <div id="navPrice" class="price-display">-</div>
                        <div id="navChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">Í≥ÑÏÇ∞Í≥µÏãù</span>
                            <span id="navFormula" class="data-value" style="font-size: 0.8em">Í∏àÌòÑÎ¨º√ó0.14</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ÏÉÅÌÉú</span>
                            <span id="navStatus" class="data-value">Í≥ÑÏÇ∞ Ï§ë</span>
                        </div>
                    </div>
                </div>

                <!-- Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î -->
                <div class="data-card" style="margin-top: 30px">
                    <div class="card-header">
                        <span class="card-icon">üìä</span>
                        <span class="card-title">ÏµúÏã† Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î</span>
                    </div>
                    <div class="table-container">
                        <table id="dataTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>ÏãúÍ∞Ñ</th>
                                    <th>USD/KRW ÌôòÏú®</th>
                                    <th>Íµ≠ÎÇ¥Í∏àETF ÌòÑÏû¨Í∞Ä</th>
                                    <th>Íµ≠ÎÇ¥Í∏àETF Îß§ÏàòÌò∏Í∞Ä</th>
                                    <th>Íµ≠ÎÇ¥Í∏àETF Îß§ÏàòÎüâ</th>
                                    <th>Íµ≠ÎÇ¥Í∏àETF Îß§ÎèÑÌò∏Í∞Ä</th>
                                    <th>Íµ≠ÎÇ¥Í∏àETF Îß§ÎèÑÎüâ</th>
                                    <th>ÎØ∏Íµ≠Í∏àÏÑ†Î¨º ÌòÑÏû¨Í∞Ä</th>
                                    <th>ÎØ∏Íµ≠Í∏àÏÑ†Î¨º Îß§ÏàòÌò∏Í∞Ä</th>
                                    <th>ÎØ∏Íµ≠Í∏àÏÑ†Î¨º Îß§ÏàòÎüâ</th>
                                    <th>ÎØ∏Íµ≠Í∏àÏÑ†Î¨º Îß§ÎèÑÌò∏Í∞Ä</th>
                                    <th>ÎØ∏Íµ≠Í∏àÏÑ†Î¨º Îß§ÎèÑÎüâ</th>
                                    <th>Íµ≠ÎÇ¥Í∏àÌòÑÎ¨º ÌòÑÏû¨Í∞Ä</th>
                                    <th>Íµ≠ÎÇ¥Í∏àÌòÑÎ¨º Îß§ÏàòÌò∏Í∞Ä</th>
                                    <th>Íµ≠ÎÇ¥Í∏àÌòÑÎ¨º Îß§ÏàòÎüâ</th>
                                    <th>Íµ≠ÎÇ¥Í∏àÌòÑÎ¨º Îß§ÎèÑÌò∏Í∞Ä</th>
                                    <th>Íµ≠ÎÇ¥Í∏àÌòÑÎ¨º Îß§ÎèÑÎüâ</th>
                                    <th>NAV (Ïõê/Ï£º)</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody">
                                <tr>
                                    <td colspan="18" class="loading-row">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="updateTimeDisplay" class="update-time"></div>
        </div>

        <script>
            let updateInterval;
            let isUpdating = false;

            // Ïà´Ïûê Ìè¨Îß∑ÌåÖ Ìï®Ïàò
            function formatNumber(num, decimals = 0) {
                if (num === null || num === undefined || isNaN(num)) return "-";
                return Number(num).toLocaleString("ko-KR", {
                    minimumFractionDigits: decimals,
                    maximumFractionDigits: decimals,
                });
            }

            // Î≥ÄÌôîÏú® Ìè¨Îß∑ÌåÖ
            function formatChange(change, changeRate) {
                if (!change || !changeRate) return "";

                const isPositive = change > 0;
                const className = isPositive ? "change-positive" : "change-negative";
                const symbol = isPositive ? "+" : "";

                return `<span class="${className}">
                ${symbol}${formatNumber(change, 2)} (${symbol}${changeRate}%)
            </span>`;
            }

            // ÏóêÎü¨ ÌëúÏãú
            function showError(message) {
                const errorContainer = document.getElementById("errorContainer");
                errorContainer.innerHTML = `<div class="error">‚ùå ${message}</div>`;
            }

            // ÏóêÎü¨ Ïà®Í∏∞Í∏∞
            function hideError() {
                document.getElementById("errorContainer").innerHTML = "";
            }

            // ÌÖåÏù¥Î∏î Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            function updateDataTable(dataArray) {
                const tableBody = document.getElementById("dataTableBody");

                if (!dataArray || !Array.isArray(dataArray) || dataArray.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="18" class="loading-row">Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</td></tr>';
                    return;
                }

                // ÏµúÏã† 10Í∞ú Îç∞Ïù¥ÌÑ∞Îßå ÌëúÏãú
                const recentData = dataArray.slice(0, 10);

                tableBody.innerHTML = recentData
                    .map((data) => {
                        const createdAt = new Date(data.created_at);
                        const timeStr = createdAt.toLocaleTimeString("ko-KR", {
                            hour: "2-digit",
                            minute: "2-digit",
                            second: "2-digit",
                        });

                        return `
                        <tr>
                            <td class="time-column">${timeStr}</td>
                            
                            <td class="usd-cell">${
                                data.usd_krw_rate ? formatNumber(data.usd_krw_rate, 2) + "Ïõê" : "-"
                            }</td>

                            <td class="price-cell">${
                                data.domestic_current_price ? formatNumber(data.domestic_current_price) + "Ïõê" : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_bid_price_1 ? formatNumber(data.domestic_bid_price_1) + "Ïõê" : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_bid_volume_1 ? formatNumber(data.domestic_bid_volume_1) + "Ï£º" : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_ask_price_1 ? formatNumber(data.domestic_ask_price_1) + "Ïõê" : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_ask_volume_1 ? formatNumber(data.domestic_ask_volume_1) + "Ï£º" : "-"
                            }</td>
                            
                            <td class="price-cell">${
                                data.domestic_gold_spot_current_price
                                    ? formatNumber(data.domestic_gold_spot_current_price) + "Ïõê"
                                    : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_gold_spot_bid_price_1
                                    ? formatNumber(data.domestic_gold_spot_bid_price_1) + "Ïõê"
                                    : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_gold_spot_bid_volume_1
                                    ? formatNumber(data.domestic_gold_spot_bid_volume_1) + "g"
                                    : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_gold_spot_ask_price_1
                                    ? formatNumber(data.domestic_gold_spot_ask_price_1) + "Ïõê"
                                    : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_gold_spot_ask_volume_1
                                    ? formatNumber(data.domestic_gold_spot_ask_volume_1) + "g"
                                    : "-"
                            }</td>

                            <td class="price-cell">${
                                data.us_futures_current_price
                                    ? "$" + formatNumber(data.us_futures_current_price, 2)
                                    : "-"
                            }</td>
                            <td class="price-cell">${
                                data.us_futures_bid_price_1 ? "$" + formatNumber(data.us_futures_bid_price_1, 2) : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.us_futures_bid_volume_1 ? formatNumber(data.us_futures_bid_volume_1) + "Í≥ÑÏïΩ" : "-"
                            }</td>
                            <td class="price-cell">${
                                data.us_futures_ask_price_1 ? "$" + formatNumber(data.us_futures_ask_price_1, 2) : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.us_futures_ask_volume_1 ? formatNumber(data.us_futures_ask_volume_1) + "Í≥ÑÏïΩ" : "-"
                            }</td>
                            
                            <td class="nav-cell">${data.nav_value ? formatNumber(data.nav_value, 2) + "Ïõê" : "-"}</td>
                        </tr>
                    `;
                    })
                    .join("");
            }

            // Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            async function updateData() {
                if (isUpdating) return;
                isUpdating = true;

                try {
                    const response = await fetch("/api/latest");
                    const result = await response.json();

                    if (result.success && result.data) {
                        console.log("Ï†ÑÏ≤¥ Í≤∞Í≥º:", result);
                        console.log("Îç∞Ïù¥ÌÑ∞ Î∞∞Ïó¥:", result.data);

                        hideError();
                        document.getElementById("loadingMessage").style.display = "none";
                        document.getElementById("dataContainer").style.display = "block";

                        // ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏ (Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Î∞∞Ïó¥ ÏÇ¨Ïö©)
                        if (Array.isArray(result.data)) {
                            updateDataTable(result.data);
                        }

                        // Îç∞Ïù¥ÌÑ∞Í∞Ä Î∞∞Ïó¥Ïù∏ Í≤ΩÏö∞ Ï≤´ Î≤àÏß∏ ÏöîÏÜå(ÏµúÏã† Îç∞Ïù¥ÌÑ∞) ÏÇ¨Ïö©
                        let data;
                        if (Array.isArray(result.data)) {
                            data = result.data[0]; // Î∞∞Ïó¥Ïùò Ï≤´ Î≤àÏß∏ ÏöîÏÜå
                            console.log("ÏµúÏã† Îç∞Ïù¥ÌÑ∞:", data);
                        } else {
                            data = result.data; // Í∞ùÏ≤¥Ïù∏ Í≤ΩÏö∞ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
                        }

                        if (!data) {
                            throw new Error("Ïú†Ìö®Ìïú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§");
                        }

                        // USD/KRW ÌôòÏú® Îç∞Ïù¥ÌÑ∞
                        if (data.usd_krw_rate) {
                            document.getElementById("usdPrice").textContent = formatNumber(data.usd_krw_rate, 2) + "Ïõê";

                            if (data.usd_change && data.usd_change_rate) {
                                document.getElementById("usdChange").innerHTML = formatChange(
                                    data.usd_change,
                                    data.usd_change_rate
                                );
                            }
                        }

                        // Íµ≠ÎÇ¥ Í∏à ETF Îç∞Ïù¥ÌÑ∞ (DB ÌïÑÎìúÎ™Ö ÏÇ¨Ïö©)
                        if (data.domestic_current_price) {
                            document.getElementById("domesticPrice").textContent =
                                formatNumber(data.domestic_current_price) + "Ïõê";

                            // Í∞ÄÍ≤© Î≥ÄÌôî Ï†ïÎ≥¥Í∞Ä ÏûàÎã§Î©¥ ÌëúÏãú
                            if (data.domestic_price_change && data.domestic_change_rate) {
                                document.getElementById("domesticChange").innerHTML = formatChange(
                                    data.domestic_price_change,
                                    data.domestic_change_rate
                                );
                            }

                            document.getElementById("domesticBid").textContent = data.domestic_bid_price_1
                                ? formatNumber(data.domestic_bid_price_1) +
                                  "Ïõê (" +
                                  formatNumber(data.domestic_bid_volume_1) +
                                  "Ï£º)"
                                : "-";
                            document.getElementById("domesticAsk").textContent = data.domestic_ask_price_1
                                ? formatNumber(data.domestic_ask_price_1) +
                                  "Ïõê (" +
                                  formatNumber(data.domestic_ask_volume_1) +
                                  "Ï£º)"
                                : "-";
                            document.getElementById("domesticVolume").textContent = data.domestic_volume
                                ? formatNumber(data.domestic_volume) + "Ï£º"
                                : "-";
                        }

                        // Íµ≠ÎÇ¥ Í∏àÌòÑÎ¨º Îç∞Ïù¥ÌÑ∞
                        if (data.domestic_gold_spot_current_price) {
                            document.getElementById("goldSpotPrice").textContent =
                                formatNumber(data.domestic_gold_spot_current_price) + "Ïõê/g";

                            document.getElementById("goldSpotBid").textContent = data.domestic_gold_spot_bid_price_1
                                ? formatNumber(data.domestic_gold_spot_bid_price_1) + "Ïõê"
                                : "-";
                            document.getElementById("goldSpotAsk").textContent = data.domestic_gold_spot_ask_price_1
                                ? formatNumber(data.domestic_gold_spot_ask_price_1) + "Ïõê"
                                : "-";
                        } else {
                            document.getElementById("goldSpotPrice").textContent = "-";
                            document.getElementById("goldSpotBid").textContent = "-";
                            document.getElementById("goldSpotAsk").textContent = "-";
                        }

                        // ÎØ∏Íµ≠ Í∏àÏÑ†Î¨º Îç∞Ïù¥ÌÑ∞
                        if (data.us_futures_current_price) {
                            document.getElementById("usPrice").textContent =
                                "$" + formatNumber(data.us_futures_current_price, 2);
                            document.getElementById("usStatus").textContent = "Ï†ïÏÉÅ";

                            if (data.us_price_change && data.us_change_rate) {
                                document.getElementById("usChange").innerHTML = formatChange(
                                    data.us_price_change,
                                    data.us_change_rate
                                );
                            }
                        } else {
                            document.getElementById("usPrice").textContent = "-";
                            document.getElementById("usStatus").textContent = "ÏãúÏû• Ïô∏ ÏãúÍ∞Ñ";
                        }

                        // NAV Îç∞Ïù¥ÌÑ∞ (Í≥ÑÏÇ∞Îêú Í∞íÎßå)
                        if (data.nav_value) {
                            document.getElementById("navPrice").textContent = formatNumber(data.nav_value, 2) + "Ïõê/Ï£º";
                            document.getElementById("navStatus").textContent = "Í≥ÑÏÇ∞ ÏôÑÎ£å";
                            document.getElementById("navFormula").textContent = "Í∏àÌòÑÎ¨º√ó0.14";
                        } else {
                            document.getElementById("navPrice").textContent = "-";
                            document.getElementById("navStatus").textContent = "Í∏àÌòÑÎ¨º Îç∞Ïù¥ÌÑ∞ ÎåÄÍ∏∞";
                            document.getElementById("navFormula").textContent = "Í∏àÌòÑÎ¨º√ó0.14";
                        }

                        // ÏàòÏßë ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                        const statusElement = document.getElementById("collectionStatus");
                        if (result.collection_status === "running") {
                            statusElement.textContent = "üü¢ Ïã§ÏãúÍ∞Ñ ÏàòÏßë Ï§ë";
                            statusElement.className = "status-item status-running";
                        } else {
                            statusElement.textContent = "üî¥ ÏàòÏßë Ï§ëÎã®";
                            statusElement.className = "status-item status-stopped";
                        }

                        // ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÍ∞Ñ
                        const updateTime = new Date(result.timestamp);
                        document.getElementById("updateTime").textContent = `üìÖ ${updateTime.toLocaleString("ko-KR")}`;
                        document.getElementById(
                            "updateTimeDisplay"
                        ).textContent = `ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${updateTime.toLocaleString("ko-KR")}`;
                    } else {
                        throw new Error(result.message || result.error || "Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§");
                    }
                } catch (error) {
                    console.error("Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:", error);
                    showError(`Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: ${error.message}`);
                }

                isUpdating = false;
            }

            // 1Ï¥àÎßàÎã§ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë
            function startAutoUpdate() {
                updateData(); // Ï¶âÏãú Ï≤´ ÏóÖÎç∞Ïù¥Ìä∏
                updateInterval = setInterval(updateData, 1000); // 1Ï¥àÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏
            }

            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏãúÏûë
            document.addEventListener("DOMContentLoaded", function () {
                console.log("üöÄ Í∏à ÏãúÏû• Ïã§ÏãúÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú ÏãúÏûë");
                startAutoUpdate();
            });

            // ÌéòÏù¥ÏßÄ Ïñ∏Î°úÎìú Ïãú Ï†ïÎ¶¨
            window.addEventListener("beforeunload", function () {
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
            });

            // ÌÉ≠ Î≥ÄÍ≤Ω Ïãú Ï≤òÎ¶¨ (ÌéòÏù¥ÏßÄÍ∞Ä Î≥¥Ïù¥ÏßÄ ÏïäÏùÑ Îïå ÏóÖÎç∞Ïù¥Ìä∏ Ï§ëÎã®)
            document.addEventListener("visibilitychange", function () {
                if (document.hidden) {
                    if (updateInterval) {
                        clearInterval(updateInterval);
                    }
                } else {
                    startAutoUpdate();
                }
            });
        </script>
    </body>
</html>
