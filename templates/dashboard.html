<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ğŸ¥‡ ê¸ˆ ì‹œì¥ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                color: #ecf0f1;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .header {
                text-align: center;
                padding: 30px 20px;
                background: rgba(0, 0, 0, 0.2);
                backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .header h1 {
                font-size: 2.5em;
                color: #f39c12;
                margin-bottom: 10px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .status-bar {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 20px;
                margin-top: 15px;
                flex-wrap: wrap;
            }

            .status-item {
                background: rgba(255, 255, 255, 0.1);
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 0.9em;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .status-running {
                background: rgba(46, 204, 113, 0.2);
                border-color: #2ecc71;
                color: #2ecc71;
            }

            .status-stopped {
                background: rgba(231, 76, 60, 0.2);
                border-color: #e74c3c;
                color: #e74c3c;
            }

            .main-content {
                flex: 1;
                padding: 40px 20px;
                max-width: 1000px;
                margin: 0 auto;
                width: 100%;
            }

            .data-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 25px;
                margin-bottom: 30px;
            }

            .data-card {
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 15px;
                padding: 25px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            }

            .data-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .card-header {
                display: flex;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .card-icon {
                font-size: 1.8em;
                margin-right: 10px;
            }

            .card-title {
                font-size: 1.2em;
                font-weight: 600;
                color: #ecf0f1;
            }

            .price-display {
                font-size: 2.2em;
                font-weight: 700;
                color: #f39c12;
                margin: 15px 0;
                text-align: center;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .price-change {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                margin-bottom: 15px;
            }

            .change-positive {
                color: #2ecc71;
            }

            .change-negative {
                color: #e74c3c;
            }

            .data-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .data-row:last-child {
                border-bottom: none;
            }

            .data-label {
                color: #bdc3c7;
                font-size: 0.9em;
            }

            .data-value {
                color: #ecf0f1;
                font-weight: 500;
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: #7f8c8d;
                font-size: 1.1em;
            }

            .error {
                background: rgba(231, 76, 60, 0.1);
                border: 1px solid rgba(231, 76, 60, 0.3);
                color: #e74c3c;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                margin-bottom: 20px;
            }

            .update-time {
                text-align: center;
                margin-top: 30px;
                color: #7f8c8d;
                font-size: 0.9em;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.6;
                }
            }

            .updating {
                animation: pulse 1s infinite;
            }

            /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
            .table-container {
                overflow-x: auto;
                margin-top: 20px;
            }

            .data-table {
                width: 100%;
                border-collapse: collapse;
                background: rgba(255, 255, 255, 0.02);
                border-radius: 8px;
                overflow: hidden;
            }

            .data-table th {
                background: rgba(255, 255, 255, 0.1);
                color: #f39c12;
                padding: 12px 8px;
                text-align: center;
                font-weight: 600;
                font-size: 0.85em;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                white-space: nowrap;
            }

            .data-table td {
                padding: 10px 8px;
                text-align: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                color: #ecf0f1;
                font-size: 0.9em;
                white-space: nowrap;
            }

            .data-table tr:hover {
                background: rgba(255, 255, 255, 0.05);
            }

            .data-table tr:nth-child(even) {
                background: rgba(255, 255, 255, 0.02);
            }

            .loading-row {
                text-align: center;
                color: #7f8c8d;
                font-style: italic;
            }

            .time-column {
                color: #3498db;
                font-weight: 500;
                min-width: 80px;
            }

            .price-cell {
                color: #f39c12;
                font-weight: 500;
            }

            .volume-cell {
                color: #95a5a6;
            }

            .usd-cell {
                color: #e74c3c;
                font-weight: 500;
            }

            @media (max-width: 768px) {
                .header h1 {
                    font-size: 2em;
                }

                .status-bar {
                    flex-direction: column;
                    gap: 10px;
                }

                .data-grid {
                    grid-template-columns: 1fr;
                    gap: 20px;
                }

                .price-display {
                    font-size: 1.8em;
                }

                .data-table {
                    font-size: 0.8em;
                }

                .data-table th,
                .data-table td {
                    padding: 8px 4px;
                }

                .data-table th {
                    font-size: 0.75em;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>ğŸ¥‡ ê¸ˆ ì‹œì¥ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</h1>
            <div class="status-bar">
                <div id="collectionStatus" class="status-item">ğŸ”„ ìˆ˜ì§‘ ìƒíƒœ í™•ì¸ ì¤‘...</div>
                <div id="updateTime" class="status-item">ğŸ“… ì—…ë°ì´íŠ¸ ì‹œê°„ í™•ì¸ ì¤‘...</div>
                <div id="autoRefresh" class="status-item">âš¡ 1ì´ˆ ìë™ ìƒˆë¡œê³ ì¹¨</div>
            </div>
        </div>

        <div class="main-content">
            <div id="errorContainer"></div>

            <div id="loadingMessage" class="loading">ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë”© ì¤‘...</div>

            <div id="dataContainer" style="display: none">
                <div class="data-grid">
                    <!-- USD/KRW í™˜ìœ¨ -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">ğŸ’±</span>
                            <span class="card-title">USD/KRW í™˜ìœ¨</span>
                        </div>
                        <div id="usdPrice" class="price-display">-</div>
                        <div id="usdChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">ì¶œì²˜</span>
                            <span class="data-value">Yahoo Finance</span>
                        </div>
                    </div>

                    <!-- êµ­ë‚´ ê¸ˆ ETF -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">ğŸ›ï¸</span>
                            <span class="card-title">êµ­ë‚´ ê¸ˆ ETF (411060)</span>
                        </div>
                        <div id="domesticPrice" class="price-display">-</div>
                        <div id="domesticChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">ë§¤ìˆ˜í˜¸ê°€</span>
                            <span id="domesticBid" class="data-value">-</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ë§¤ë„í˜¸ê°€</span>
                            <span id="domesticAsk" class="data-value">-</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ê±°ë˜ëŸ‰</span>
                            <span id="domesticVolume" class="data-value">-</span>
                        </div>
                    </div>

                    <!-- ë¯¸êµ­ ê¸ˆì„ ë¬¼ -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">ğŸ‡ºğŸ‡¸</span>
                            <span class="card-title">ë¯¸êµ­ ê¸ˆì„ ë¬¼</span>
                        </div>
                        <div id="usPrice" class="price-display">-</div>
                        <div id="usChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">ìƒíƒœ</span>
                            <span id="usStatus" class="data-value">í™•ì¸ ì¤‘</span>
                        </div>
                    </div>

                    <!-- êµ­ë‚´ ê¸ˆí˜„ë¬¼ -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">âœ¨</span>
                            <span class="card-title">êµ­ë‚´ ê¸ˆí˜„ë¬¼</span>
                        </div>
                        <div id="goldSpotPrice" class="price-display">-</div>
                        <div id="goldSpotChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">ë§¤ìˆ˜í˜¸ê°€</span>
                            <span id="goldSpotBid" class="data-value">-</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ë§¤ë„í˜¸ê°€</span>
                            <span id="goldSpotAsk" class="data-value">-</span>
                        </div>
                    </div>

                    <!-- NAV ê³„ì‚° -->
                    <div class="data-card">
                        <div class="card-header">
                            <span class="card-icon">ğŸ’°</span>
                            <span class="card-title">NAV (ì´ë¡ ê°€ê²©)</span>
                        </div>
                        <div id="navPrice" class="price-display">-</div>
                        <div id="navChange" class="price-change"></div>
                        <div class="data-row">
                            <span class="data-label">ê³„ì‚°ê³µì‹</span>
                            <span id="navFormula" class="data-value" style="font-size: 0.8em">ê¸ˆí˜„ë¬¼Ã—0.14</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">ìƒíƒœ</span>
                            <span id="navStatus" class="data-value">ê³„ì‚° ì¤‘</span>
                        </div>
                    </div>
                </div>

                <!-- ì‹¤ì‹œê°„ ë°ì´í„° í…Œì´ë¸” -->
                <div class="data-card" style="margin-top: 30px">
                    <div class="card-header">
                        <span class="card-icon">ğŸ“Š</span>
                        <span class="card-title">ìµœì‹  ë°ì´í„° í…Œì´ë¸”</span>
                    </div>
                    <div class="table-container">
                        <table id="dataTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>ì‹œê°„</th>
                                    <th>USD/KRW í™˜ìœ¨</th>
                                    <th>êµ­ë‚´ê¸ˆETF í˜„ì¬ê°€</th>
                                    <th>êµ­ë‚´ê¸ˆETF ë§¤ìˆ˜í˜¸ê°€</th>
                                    <th>êµ­ë‚´ê¸ˆETF ë§¤ìˆ˜ëŸ‰</th>
                                    <th>êµ­ë‚´ê¸ˆETF ë§¤ë„í˜¸ê°€</th>
                                    <th>êµ­ë‚´ê¸ˆETF ë§¤ë„ëŸ‰</th>
                                    <th>ë¯¸êµ­ê¸ˆì„ ë¬¼ í˜„ì¬ê°€</th>
                                    <th>ë¯¸êµ­ê¸ˆì„ ë¬¼ ë§¤ìˆ˜í˜¸ê°€</th>
                                    <th>ë¯¸êµ­ê¸ˆì„ ë¬¼ ë§¤ìˆ˜ëŸ‰</th>
                                    <th>ë¯¸êµ­ê¸ˆì„ ë¬¼ ë§¤ë„í˜¸ê°€</th>
                                    <th>ë¯¸êµ­ê¸ˆì„ ë¬¼ ë§¤ë„ëŸ‰</th>
                                    <th>êµ­ë‚´ê¸ˆí˜„ë¬¼ í˜„ì¬ê°€</th>
                                    <th>êµ­ë‚´ê¸ˆí˜„ë¬¼ ë§¤ìˆ˜í˜¸ê°€</th>
                                    <th>êµ­ë‚´ê¸ˆí˜„ë¬¼ ë§¤ìˆ˜ëŸ‰</th>
                                    <th>êµ­ë‚´ê¸ˆí˜„ë¬¼ ë§¤ë„í˜¸ê°€</th>
                                    <th>êµ­ë‚´ê¸ˆí˜„ë¬¼ ë§¤ë„ëŸ‰</th>
                                    <th>NAV (ì›/ì£¼)</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody">
                                <tr>
                                    <td colspan="18" class="loading-row">ë°ì´í„° ë¡œë”© ì¤‘...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="updateTimeDisplay" class="update-time"></div>
        </div>

        <script>
            let updateInterval;
            let isUpdating = false;

            // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜
            function formatNumber(num, decimals = 0) {
                if (num === null || num === undefined || isNaN(num)) return "-";
                return Number(num).toLocaleString("ko-KR", {
                    minimumFractionDigits: decimals,
                    maximumFractionDigits: decimals,
                });
            }

            // ë³€í™”ìœ¨ í¬ë§·íŒ…
            function formatChange(change, changeRate) {
                if (!change || !changeRate) return "";

                const isPositive = change > 0;
                const className = isPositive ? "change-positive" : "change-negative";
                const symbol = isPositive ? "+" : "";

                return `<span class="${className}">
                ${symbol}${formatNumber(change, 2)} (${symbol}${changeRate}%)
            </span>`;
            }

            // ì—ëŸ¬ í‘œì‹œ
            function showError(message) {
                const errorContainer = document.getElementById("errorContainer");
                errorContainer.innerHTML = `<div class="error">âŒ ${message}</div>`;
            }

            // ì—ëŸ¬ ìˆ¨ê¸°ê¸°
            function hideError() {
                document.getElementById("errorContainer").innerHTML = "";
            }

            // í…Œì´ë¸” ë°ì´í„° ì—…ë°ì´íŠ¸
            function updateDataTable(dataArray) {
                const tableBody = document.getElementById("dataTableBody");

                if (!dataArray || !Array.isArray(dataArray) || dataArray.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="18" class="loading-row">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                    return;
                }

                // ìµœì‹  10ê°œ ë°ì´í„°ë§Œ í‘œì‹œ
                const recentData = dataArray.slice(0, 10);

                tableBody.innerHTML = recentData
                    .map((data) => {
                        const createdAt = new Date(data.created_at);
                        const timeStr = createdAt.toLocaleTimeString("ko-KR", {
                            hour: "2-digit",
                            minute: "2-digit",
                            second: "2-digit",
                        });

                        return `
                        <tr>
                            <td class="time-column">${timeStr}</td>
                            
                            <td class="usd-cell">${
                                data.usd_krw_rate ? formatNumber(data.usd_krw_rate, 2) + "ì›" : "-"
                            }</td>

                            <td class="price-cell">${
                                data.domestic_current_price ? formatNumber(data.domestic_current_price) + "ì›" : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_bid_price_1 ? formatNumber(data.domestic_bid_price_1) + "ì›" : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_bid_volume_1 ? formatNumber(data.domestic_bid_volume_1) + "ì£¼" : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_ask_price_1 ? formatNumber(data.domestic_ask_price_1) + "ì›" : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_ask_volume_1 ? formatNumber(data.domestic_ask_volume_1) + "ì£¼" : "-"
                            }</td>
                            
                            <td class="price-cell">${
                                data.domestic_gold_spot_current_price
                                    ? formatNumber(data.domestic_gold_spot_current_price) + "ì›"
                                    : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_gold_spot_bid_price_1
                                    ? formatNumber(data.domestic_gold_spot_bid_price_1) + "ì›"
                                    : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_gold_spot_bid_volume_1
                                    ? formatNumber(data.domestic_gold_spot_bid_volume_1) + "g"
                                    : "-"
                            }</td>
                            <td class="price-cell">${
                                data.domestic_gold_spot_ask_price_1
                                    ? formatNumber(data.domestic_gold_spot_ask_price_1) + "ì›"
                                    : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.domestic_gold_spot_ask_volume_1
                                    ? formatNumber(data.domestic_gold_spot_ask_volume_1) + "g"
                                    : "-"
                            }</td>

                            <td class="price-cell">${
                                data.us_futures_current_price
                                    ? "$" + formatNumber(data.us_futures_current_price, 2)
                                    : "-"
                            }</td>
                            <td class="price-cell">${
                                data.us_futures_bid_price_1 ? "$" + formatNumber(data.us_futures_bid_price_1, 2) : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.us_futures_bid_volume_1 ? formatNumber(data.us_futures_bid_volume_1) + "ê³„ì•½" : "-"
                            }</td>
                            <td class="price-cell">${
                                data.us_futures_ask_price_1 ? "$" + formatNumber(data.us_futures_ask_price_1, 2) : "-"
                            }</td>
                            <td class="volume-cell">${
                                data.us_futures_ask_volume_1 ? formatNumber(data.us_futures_ask_volume_1) + "ê³„ì•½" : "-"
                            }</td>
                            
                            <td class="nav-cell">${data.nav_value ? formatNumber(data.nav_value, 2) + "ì›" : "-"}</td>
                        </tr>
                    `;
                    })
                    .join("");
            }

            // ë°ì´í„° ì—…ë°ì´íŠ¸
            async function updateData() {
                if (isUpdating) return;
                isUpdating = true;

                try {
                    const response = await fetch("/api/latest");
                    const result = await response.json();

                    if (result.success && result.data) {
                        console.log("ì „ì²´ ê²°ê³¼:", result);
                        console.log("ë°ì´í„° ë°°ì—´:", result.data);

                        hideError();
                        document.getElementById("loadingMessage").style.display = "none";
                        document.getElementById("dataContainer").style.display = "block";

                        // í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì „ì²´ ë°ì´í„° ë°°ì—´ ì‚¬ìš©)
                        if (Array.isArray(result.data)) {
                            updateDataTable(result.data);
                        }

                        // ë°ì´í„°ê°€ ë°°ì—´ì¸ ê²½ìš° ì²« ë²ˆì§¸ ìš”ì†Œ(ìµœì‹  ë°ì´í„°) ì‚¬ìš©
                        let data;
                        if (Array.isArray(result.data)) {
                            data = result.data[0]; // ë°°ì—´ì˜ ì²« ë²ˆì§¸ ìš”ì†Œ
                            console.log("ìµœì‹  ë°ì´í„°:", data);
                        } else {
                            data = result.data; // ê°ì²´ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
                        }

                        if (!data) {
                            throw new Error("ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");
                        }

                        // USD/KRW í™˜ìœ¨ ë°ì´í„°
                        if (data.usd_krw_rate) {
                            document.getElementById("usdPrice").textContent = formatNumber(data.usd_krw_rate, 2) + "ì›";

                            if (data.usd_change && data.usd_change_rate) {
                                document.getElementById("usdChange").innerHTML = formatChange(
                                    data.usd_change,
                                    data.usd_change_rate
                                );
                            }
                        }

                        // êµ­ë‚´ ê¸ˆ ETF ë°ì´í„° (DB í•„ë“œëª… ì‚¬ìš©)
                        if (data.domestic_current_price) {
                            document.getElementById("domesticPrice").textContent =
                                formatNumber(data.domestic_current_price) + "ì›";

                            // ê°€ê²© ë³€í™” ì •ë³´ê°€ ìˆë‹¤ë©´ í‘œì‹œ
                            if (data.domestic_price_change && data.domestic_change_rate) {
                                document.getElementById("domesticChange").innerHTML = formatChange(
                                    data.domestic_price_change,
                                    data.domestic_change_rate
                                );
                            }

                            document.getElementById("domesticBid").textContent = data.domestic_bid_price_1
                                ? formatNumber(data.domestic_bid_price_1) +
                                  "ì› (" +
                                  formatNumber(data.domestic_bid_volume_1) +
                                  "ì£¼)"
                                : "-";
                            document.getElementById("domesticAsk").textContent = data.domestic_ask_price_1
                                ? formatNumber(data.domestic_ask_price_1) +
                                  "ì› (" +
                                  formatNumber(data.domestic_ask_volume_1) +
                                  "ì£¼)"
                                : "-";
                            document.getElementById("domesticVolume").textContent = data.domestic_volume
                                ? formatNumber(data.domestic_volume) + "ì£¼"
                                : "-";
                        }

                        // êµ­ë‚´ ê¸ˆí˜„ë¬¼ ë°ì´í„°
                        if (data.domestic_gold_spot_current_price) {
                            document.getElementById("goldSpotPrice").textContent =
                                formatNumber(data.domestic_gold_spot_current_price) + "ì›/g";

                            document.getElementById("goldSpotBid").textContent = data.domestic_gold_spot_bid_price_1
                                ? formatNumber(data.domestic_gold_spot_bid_price_1) + "ì›"
                                : "-";
                            document.getElementById("goldSpotAsk").textContent = data.domestic_gold_spot_ask_price_1
                                ? formatNumber(data.domestic_gold_spot_ask_price_1) + "ì›"
                                : "-";
                        } else {
                            document.getElementById("goldSpotPrice").textContent = "-";
                            document.getElementById("goldSpotBid").textContent = "-";
                            document.getElementById("goldSpotAsk").textContent = "-";
                        }

                        // ë¯¸êµ­ ê¸ˆì„ ë¬¼ ë°ì´í„°
                        if (data.us_futures_current_price) {
                            document.getElementById("usPrice").textContent =
                                "$" + formatNumber(data.us_futures_current_price, 2);
                            document.getElementById("usStatus").textContent = "ì •ìƒ";

                            if (data.us_price_change && data.us_change_rate) {
                                document.getElementById("usChange").innerHTML = formatChange(
                                    data.us_price_change,
                                    data.us_change_rate
                                );
                            }
                        } else {
                            document.getElementById("usPrice").textContent = "-";
                            document.getElementById("usStatus").textContent = "ì‹œì¥ ì™¸ ì‹œê°„";
                        }

                        // NAV ë°ì´í„° (ê³„ì‚°ëœ ê°’ë§Œ)
                        if (data.nav_value) {
                            document.getElementById("navPrice").textContent = formatNumber(data.nav_value, 2) + "ì›/ì£¼";
                            document.getElementById("navStatus").textContent = "ê³„ì‚° ì™„ë£Œ";
                            document.getElementById("navFormula").textContent = "ê¸ˆí˜„ë¬¼Ã—0.14";
                        } else {
                            document.getElementById("navPrice").textContent = "-";
                            document.getElementById("navStatus").textContent = "ê¸ˆí˜„ë¬¼ ë°ì´í„° ëŒ€ê¸°";
                            document.getElementById("navFormula").textContent = "ê¸ˆí˜„ë¬¼Ã—0.14";
                        }

                        // ìˆ˜ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸
                        const statusElement = document.getElementById("collectionStatus");
                        if (result.collection_status === "running") {
                            statusElement.textContent = "ğŸŸ¢ ì‹¤ì‹œê°„ ìˆ˜ì§‘ ì¤‘";
                            statusElement.className = "status-item status-running";
                        } else {
                            statusElement.textContent = "ğŸ”´ ìˆ˜ì§‘ ì¤‘ë‹¨";
                            statusElement.className = "status-item status-stopped";
                        }

                        // ì—…ë°ì´íŠ¸ ì‹œê°„
                        const updateTime = new Date(result.timestamp);
                        document.getElementById("updateTime").textContent = `ğŸ“… ${updateTime.toLocaleString("ko-KR")}`;
                        document.getElementById(
                            "updateTimeDisplay"
                        ).textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${updateTime.toLocaleString("ko-KR")}`;
                    } else {
                        throw new Error(result.message || result.error || "ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
                    }
                } catch (error) {
                    console.error("ë°ì´í„° ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error);
                    showError(`ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                }

                isUpdating = false;
            }

            // 1ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘
            function startAutoUpdate() {
                updateData(); // ì¦‰ì‹œ ì²« ì—…ë°ì´íŠ¸
                updateInterval = setInterval(updateData, 1000); // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œì‘
            document.addEventListener("DOMContentLoaded", function () {
                console.log("ğŸš€ ê¸ˆ ì‹œì¥ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ ì‹œì‘");
                startAutoUpdate();
            });

            // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
            window.addEventListener("beforeunload", function () {
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
            });

            // íƒ­ ë³€ê²½ ì‹œ ì²˜ë¦¬ (í˜ì´ì§€ê°€ ë³´ì´ì§€ ì•Šì„ ë•Œ ì—…ë°ì´íŠ¸ ì¤‘ë‹¨)
            document.addEventListener("visibilitychange", function () {
                if (document.hidden) {
                    if (updateInterval) {
                        clearInterval(updateInterval);
                    }
                } else {
                    startAutoUpdate();
                }
            });
        </script>
    </body>
</html>
